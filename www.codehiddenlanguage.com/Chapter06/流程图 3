┌─────────────────────────────────────────────────────────────────┐
│                        页面加载                                  │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  CircuitBuilder(canvasParallel, Chapter06SwitchesInParallel)    │
│  ─ 创建组件: battery, switch1, switch2, node1, node2, light      │
│  ─ 创建导线: 7条连接线                                             │
│  ─ testable=true → 为 switch1/switch2 注册 notifyChange 回调      │
│  ─ 初始调用 CircuitChange('') 计算初始状态                          │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      等待用户交互                                 │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   用户点击画布 (click)                            │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
                    ┌─────────────────┐
                    │ Switch.onClick  │
                    │ 命中测试 hittest │
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              ▼                             ▼
     ┌────────────────┐            ┌────────────────┐
     │ 命中 switch1   │            │ 命中 switch2    │
     │ 或 switch2     │            │ 或都未命中       │
     └───────┬────────┘            └───────┬────────┘
             │                             │
             ▼                             ▼
   ┌──────────────────┐              ┌───────────┐
   │ closed = !closed │              │   结束    │
   │ 翻转开关状态      │               └───────────┘
   └────────┬─────────┘
            ▼
   ┌──────────────────┐
   │ setOutput()      │
   │ → render() 重绘  │
   │ → notifyFunc(id) │
   └────────┬─────────┘
            ▼
┌─────────────────────────────────────────────────────────────────┐
│              CircuitBuilder.CircuitChange(name)                 │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  TestCompleteCircuit: 从 battery 出发递归搜索闭合回路            │
│                                                                 │
│  并联逻辑:                                                       │
│    路径A: battery→node1→switch1→node2→light→battery             │
│    路径B: battery→node1→switch2→node2→light→battery             │
│                                                                 │
│  只要 switch1.closed OR switch2.closed 为 true                  │
│  就存在至少一条闭合回路                                          │
└─────────────────────────────┬───────────────────────────────────┘
                              ▼
                  ┌───────────────────────┐
                  │ 存在闭合回路？         │
                  └───────────┬───────────┘
                              │
           ┌──────────────────┴──────────────────┐
           ▼                                     ▼
  ┌─────────────────┐                   ┌─────────────────┐
  │ 是 (OR 成立)    │                   │ 否 (两开关都断) │
  └────────┬────────┘                   └────────┬────────┘
           ▼                                     ▼
┌────────────────────────┐            ┌────────────────────────┐
│ ColorCircuit:          │            │ ColorCircuit:          │
│ ─ 闭合路径上的导线     │            │ ─ 所有导线 output=false│
│   output=true (红色)   │            │   (黑色)               │
│ ─ 闭合路径上的组件     │            │ ─ 所有组件 output=false│
│   output=true          │            │                        │
│ ─ 灯泡亮 (红色)        │            │ ─ 灯泡灭 (黑色)        │
└────────────────────────┘            └────────────────────────┘
           │                                     │
           └──────────────┬──────────────────────┘
                          ▼
                   ┌────────────┐
                   │ 重绘完成   │
                   │ 等待下次点击│
                   └────────────┘